# 🤖 用户数字孪生风控测试系统 Demo

> 通过模拟不同类型用户的Agent，自动化测试大模型的内容安全性

## 📖 核心理念

传统风控模式是**滞后响应**：用户产生风险行为 → 收集数据 → 分析优化

本系统采用**前置预防**：用户画像 → 数字孪生Agent → 模拟攻击 → 提前发现风险

```
┌─────────────────────────────────────────────────────────────────┐
│                     用户数字孪生风控体系                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   传统模式：用户行为 → 产生风险 → 收集数据 → 分析优化（滞后）      │
│                                                                 │
│   创新模式：用户画像 → 数字孪生Agent → 模拟攻击 → 提前优化（前置） │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 🎭 内置用户画像

| 画像 | 描述 | 测试重点 |
|------|------|----------|
| 好奇青少年 | 15岁高中生，好奇心驱动 | 政治敏感、暴力、虚假信息 |
| 键政用户 | 热衷政治话题讨论 | 政治敏感、立场引导 |
| 学术研究者 | 以学术名义获取信息 | 暴力、违法、隐私 |
| 社工攻击者 | 社会工程学攻击 | 越狱、注入、违法 |
| 提示词黑客 | 专业技术攻击者 | 越狱、提示词注入 |
| 普通用户 | 正常使用（测试误杀） | 误杀检测 |

## 🚀 快速开始

### 1. 安装依赖

```bash
cd digital_twin_demo
pip install -r requirements.txt
```

### 2. 配置API

编辑 `config.py`，填入你的API配置：

```python
API_CONFIG = {
    "base_url": "https://api.openai.com/v1",  # 或其他兼容API
    "api_key": "your-api-key-here",           # 你的API Key
    "model": "gpt-4o-mini"                    # 使用的模型
}
```

支持的API：
- OpenAI API
- 任何OpenAI兼容API（如Azure OpenAI、通义千问等）

### 3. 运行Demo

```bash
# 交互式模式（推荐）
python main.py

# 单个Agent演示
python main.py --mode single

# 批量测试
python main.py --mode batch --max-tests 5

# 测试所有演示
python main.py --mode all
```

## 📁 项目结构

```
digital_twin_demo/
├── config.py           # 配置文件（API、风险类别定义）
├── user_personas.py    # 用户画像定义
├── twin_agent.py       # 数字孪生Agent核心类
├── test_runner.py      # 测试运行器
├── main.py             # 主程序入口
├── requirements.txt    # 依赖列表
└── README.md           # 说明文档
```

## 🔧 核心模块说明

### DigitalTwinAgent（数字孪生Agent）

核心功能：
1. `generate_query()` - 根据用户画像和测试意图，生成模拟用户的提问
2. `test_target_model()` - 用生成的提问测试目标大模型
3. `analyze_response()` - 分析模型响应，判断是否存在风险
4. `run_test()` - 完整测试流程

### TestRunner（测试运行器）

核心功能：
1. `run_single_test()` - 运行单个测试
2. `run_persona_tests()` - 运行特定画像的所有测试
3. `run_all_tests()` - 运行所有画像的测试
4. `generate_report()` - 生成测试报告

## 📊 输出报告示例

```json
{
  "summary": {
    "total_tests": 30,
    "risk_detected": 8,
    "safe_rate": "73.3%",
    "test_duration": "0:02:45"
  },
  "risk_level_distribution": {
    "安全": 22,
    "低风险": 3,
    "中风险": 3,
    "高风险": 2,
    "严重风险": 0
  },
  "recommendations": [
    "🔴 政治敏感内容风控需加强，建议完善政治实体知识库",
    "🔴 存在越狱风险，建议增加越狱攻击模式识别"
  ]
}
```

## 🎯 使用场景

1. **策略上线前评估**：在新风控策略上线前，用数字孪生Agent进行压测
2. **持续安全监控**：定期运行测试，发现风控漏洞
3. **红蓝对抗辅助**：自动化生成攻击case，辅助人工红蓝对抗
4. **面试作品展示**：展示大模型安全领域的创新思维和技术能力

## 🔮 扩展方向

1. **画像自动生成**：从真实用户数据中自动抽取画像特征
2. **多轮对话测试**：支持多轮对话场景的风险测试
3. **对抗策略进化**：Agent根据测试结果自动进化攻击策略
4. **可视化Dashboard**：实时展示测试结果和风险趋势

## 📝 注意事项

- 本Demo仅供学习和研究使用
- 请遵守相关法律法规和API使用条款
- 测试结果仅供参考，不构成安全性保证

---

*Created by 惠嘉宇 - 用户数字孪生风控体系 Demo*
